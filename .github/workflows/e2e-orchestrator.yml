# Copyright (c) Microsoft Corporation.
# Licensed under the MIT License.

name: E2E Test Orchestrator

on:
  schedule:
    # Run every 6 hours
    - cron: '0 */6 * * *'
  push:
    branches: [main]
    paths:
      - 'python/openai/**'
      - 'nodejs/openai/**'
      - 'dotnet/semantic-kernel/**'
      - 'dotnet/agent-framework/**'
      - '.github/workflows/e2e-*.yml'
      - 'scripts/e2e/**'
  pull_request:
    branches: [main]
    paths:
      - 'python/openai/**'
      - 'nodejs/openai/**'
      - 'dotnet/semantic-kernel/**'
      - 'dotnet/agent-framework/**'
      - '.github/workflows/e2e-*.yml'
      - 'scripts/e2e/**'
  workflow_dispatch:
    inputs:
      sample:
        description: 'Sample to test (leave empty for all)'
        required: false
        type: choice
        options:
          - ''
          - 'python-openai'
          - 'nodejs-openai'
          - 'dotnet-sk'
          - 'dotnet-af'

permissions:
  contents: read

jobs:
  trigger-e2e-tests:
    name: Trigger E2E Tests
    runs-on: ubuntu-latest
    strategy:
      matrix:
        sample:
          - python-openai
          - nodejs-openai
          - dotnet-sk
          - dotnet-af
    steps:
      - name: Trigger ${{ matrix.sample }} E2E Test
        if: ${{ github.event.inputs.sample == '' || github.event.inputs.sample == matrix.sample }}
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const workflowMap = {
              'python-openai': 'e2e-python-openai.yml',
              'nodejs-openai': 'e2e-nodejs-openai.yml',
              'dotnet-sk': 'e2e-dotnet-sk.yml',
              'dotnet-af': 'e2e-dotnet-af.yml'
            };
            
            const sample = '${{ matrix.sample }}';
            const workflow = workflowMap[sample];
            
            console.log(`Triggering ${workflow} for ${sample}...`);
            
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: workflow,
              ref: context.ref
            });
            
            console.log(`Successfully triggered ${workflow}`);
